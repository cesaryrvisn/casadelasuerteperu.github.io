<!-- üî• Sorteo Diario Acumulable Script -->
<script type="module">
  // Configura Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, get, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCj-REEMPLAZA-CON-LA-TUYA",
    authDomain: "casa-de-la-suerte.firebaseapp.com",
    databaseURL: "https://casa-de-la-suerte-default-rtdb.firebaseio.com",
    projectId: "casa-de-la-suerte",
    storageBucket: "casa-de-la-suerte.appspot.com",
    messagingSenderId: "000000000000",
    appId: "1:000000000000:web:xxxxxxxxxxxxxxxx"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const pozoRef = ref(db, "pozo_diario");
  const acumuladoRef = ref(db, "acumulado_total");
  const modoAcumulableRef = ref(db, "modo_acumulable");

  const pozoDisplay = document.querySelector("#pozo-actual");
  const ticketsInput = document.querySelector("#tickets");
  const comprarBtn = document.querySelector("#comprar-btn");
  const acumuladoDisplay = document.querySelector("#acumulado");

  // Inicializa los valores
  async function initPozo() {
    const snapshot = await get(pozoRef);
    if (!snapshot.exists()) {
      await set(pozoRef, { monto: 0, fecha: new Date().toDateString() });
    }
    const acumuladoSnap = await get(acumuladoRef);
    if (!acumuladoSnap.exists()) {
      await set(acumuladoRef, { total: 0 });
    }
    const modoSnap = await get(modoAcumulableRef);
    if (!modoSnap.exists()) {
      await set(modoAcumulableRef, { activo: true });
    }
  }

  initPozo();

  // Escucha los cambios en tiempo real
  onValue(pozoRef, (snapshot) => {
    const data = snapshot.val();
    if (data) pozoDisplay.textContent = `S/ ${data.monto.toFixed(2)}`;
  });

  onValue(acumuladoRef, (snapshot) => {
    const data = snapshot.val();
    if (data) acumuladoDisplay.textContent = `Acumulado total: S/ ${data.total.toFixed(2)}`;
  });

  // Bot√≥n de compra
  comprarBtn.addEventListener("click", async () => {
    const cantidad = parseInt(ticketsInput.value) || 1;
    const snapshot = await get(pozoRef);
    const data = snapshot.val() || { monto: 0 };
    const nuevoPozo = data.monto + cantidad;
    await update(pozoRef, { monto: nuevoPozo });
    alert(`‚úÖ Has comprado ${cantidad} ticket(s). ¬°Suerte! üçÄ`);
  });

  // Reinicia el pozo a medianoche
  setInterval(async () => {
    const now = new Date();
    if (now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() === 0) {
      const pozoSnap = await get(pozoRef);
      const modoSnap = await get(modoAcumulableRef);
      const acumuladoSnap = await get(acumuladoRef);
      const pozoActual = pozoSnap.val().monto;
      const acumuladoActual = acumuladoSnap.val().total;
      const modo = modoSnap.val().activo;

      if (modo) {
        await update(acumuladoRef, { total: acumuladoActual + pozoActual });
      }
      await set(pozoRef, { monto: 0, fecha: new Date().toDateString() });
    }
  }, 1000);
</script>

<!-- üßæ Elementos HTML que deben existir -->
<p><strong>Pozo actual:</strong> <span id="pozo-actual">S/ 0.00</span></p>
<p><strong id="acumulado">Acumulado total: S/ 0.00</strong></p>
<label>Tickets: <input type="number" id="tickets" value="1" min="1"></label>
<button id="comprar-btn">üéüÔ∏è Comprar ticket(s)</button>
